<Window x:Class="AgentDock.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:AgentDock"
        mc:Ignorable="d"
        Title="Agent Dock"
        Height="720" Width="1280"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        WindowStyle="None"
        Icon="/Assets/agentdock.png"
        Closing="MainWindow_Closing">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="44"
                      ResizeBorderThickness="4"
                      GlassFrameThickness="0"
                      CornerRadius="0" />
    </WindowChrome.WindowChrome>

    <DockPanel x:Name="RootPanel" LastChildFill="True">

        <!-- ===== Custom Title Bar ===== -->
        <Border DockPanel.Dock="Top"
                Background="{DynamicResource TitleBarBackground}"
                Height="44">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" /> <!-- Icon -->
                    <ColumnDefinition Width="Auto" /> <!-- Product name -->
                    <ColumnDefinition Width="Auto" /> <!-- Menu -->
                    <ColumnDefinition Width="Auto" /> <!-- Add button -->
                    <ColumnDefinition Width="*" />    <!-- Title (fills) -->
                    <ColumnDefinition Width="Auto" /> <!-- Total cost -->
                    <ColumnDefinition Width="Auto" /> <!-- Minimize -->
                    <ColumnDefinition Width="Auto" /> <!-- Maximize -->
                    <ColumnDefinition Width="Auto" /> <!-- Close -->
                </Grid.ColumnDefinitions>

                <!-- App icon -->
                <Image Grid.Column="0"
                       Source="/Assets/agentdock.png"
                       Width="18" Height="18"
                       RenderOptions.BitmapScalingMode="HighQuality"
                       VerticalAlignment="Center"
                       Margin="10,0,6,0"
                       WindowChrome.IsHitTestVisibleInChrome="True" />

                <!-- Product name -->
                <TextBlock Grid.Column="1"
                           Text="Agent Dock"
                           FontSize="12"
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource TitleBarForeground}"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0" />

                <!-- Separator between product name and menu -->
                <Border Grid.Column="1"
                        Width="1" Height="18"
                        Background="{DynamicResource TabButtonBorderBrush}"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Right"
                        Margin="4,0,0,0" />

                <!-- Menu bar -->
                <Menu Grid.Column="2"
                      VerticalAlignment="Center"
                      Margin="4,0,0,0"
                      WindowChrome.IsHitTestVisibleInChrome="True">
                    <MenuItem x:Name="FileMenu" Header="_File">
                        <MenuItem Header="_Add Project Folder" InputGestureText="Ctrl+N" Click="AddProject_Click">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xED25;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                                           Foreground="{DynamicResource MenuIconForeground}" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator />
                        <MenuItem Header="_Open Workspace" Click="OpenWorkspace_Click">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE8E5;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                                           Foreground="{DynamicResource MenuIconForeground}" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="_Save Workspace" InputGestureText="Ctrl+S" Click="SaveWorkspace_Click">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE74E;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                                           Foreground="{DynamicResource MenuIconForeground}" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator x:Name="RecentWorkspacesSeparator" Visibility="Collapsed" />
                        <MenuItem x:Name="RecentWorkspacesHeader" Header="Recent Workspaces"
                                  IsEnabled="False" Visibility="Collapsed" />
                        <Separator x:Name="ExitSeparator" />
                        <MenuItem Header="E_xit" InputGestureText="Alt+F4" Click="Exit_Click">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE8BB;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                                           Foreground="{DynamicResource MenuIconForeground}" />
                            </MenuItem.Icon>
                        </MenuItem>
                    </MenuItem>
                    <MenuItem Header="S_ettings">
                        <MenuItem Header="_Theme" x:Name="ThemeMenu">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE790;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                                           Foreground="{DynamicResource MenuIconForeground}" />
                            </MenuItem.Icon>
                            <!-- Items populated dynamically in code-behind -->
                        </MenuItem>
                        <MenuItem Header="Toolbar _Position">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE8E4;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                                           Foreground="{DynamicResource MenuIconForeground}" />
                            </MenuItem.Icon>
                            <MenuItem Header="_Top" x:Name="ToolbarTopMenu" IsCheckable="True" IsChecked="True"
                                      Click="ToolbarPosition_Click" Tag="Top">
                                <MenuItem.Icon>
                                    <TextBlock Text="&#xE74A;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                                               Foreground="{DynamicResource MenuIconForeground}" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="_Left" x:Name="ToolbarLeftMenu" IsCheckable="True"
                                      Click="ToolbarPosition_Click" Tag="Left">
                                <MenuItem.Icon>
                                    <TextBlock Text="&#xE76B;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                                               Foreground="{DynamicResource MenuIconForeground}" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="_Right" x:Name="ToolbarRightMenu" IsCheckable="True"
                                      Click="ToolbarPosition_Click" Tag="Right">
                                <MenuItem.Icon>
                                    <TextBlock Text="&#xE76C;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                                               Foreground="{DynamicResource MenuIconForeground}" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="_Bottom" x:Name="ToolbarBottomMenu" IsCheckable="True"
                                      Click="ToolbarPosition_Click" Tag="Bottom">
                                <MenuItem.Icon>
                                    <TextBlock Text="&#xE74B;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                                               Foreground="{DynamicResource MenuIconForeground}" />
                                </MenuItem.Icon>
                            </MenuItem>
                        </MenuItem>
                        <Separator />
                        <MenuItem Header="_Claude Path Override..." Click="ClaudePathOverride_Click">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE713;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                                           Foreground="{DynamicResource MenuIconForeground}" />
                            </MenuItem.Icon>
                        </MenuItem>
                    </MenuItem>
                    <MenuItem Header="_Help">
                        <MenuItem Header="_Getting Started" Click="GettingStarted_Click">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE736;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                                           Foreground="{DynamicResource MenuIconForeground}" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="Check _Prerequisites" Click="CheckPrerequisites_Click">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE9D5;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                                           Foreground="{DynamicResource MenuIconForeground}" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator />
                        <MenuItem Header="_About Agent Dock" Click="About_Click">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE946;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                                           Foreground="{DynamicResource MenuIconForeground}" />
                            </MenuItem.Icon>
                        </MenuItem>
                    </MenuItem>
                </Menu>

                <!-- Add project button -->
                <Button x:Name="AddProjectButton" Grid.Column="3"
                        Click="AddProject_Click"
                        ToolTip="Add Project Folder (Ctrl+N)"
                        Height="24"
                        VerticalAlignment="Center"
                        Margin="4,0,0,0"
                        Padding="6,0"
                        Cursor="Hand"
                        WindowChrome.IsHitTestVisibleInChrome="True">
                    <Button.Style>
                        <Style TargetType="{x:Type Button}">
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="BorderBrush" Value="{DynamicResource AddButtonBorderBrush}" />
                            <Setter Property="BorderThickness" Value="1" />
                            <Setter Property="Foreground" Value="{DynamicResource AddButtonForeground}" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="{x:Type Button}">
                                        <Border x:Name="Bd"
                                                Background="{TemplateBinding Background}"
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                CornerRadius="3"
                                                Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center"
                                                              VerticalAlignment="Center" />
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Bd" Property="Background"
                                                        Value="{DynamicResource TitleBarButtonHover}" />
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE710;"
                                   FontFamily="Segoe MDL2 Assets"
                                   FontSize="10"
                                   Foreground="{DynamicResource AddButtonForeground}"
                                   VerticalAlignment="Center" />
                    </StackPanel>
                </Button>

                <!-- Window title (fills remaining space, shows project name) -->
                <TextBlock x:Name="TitleBarText" Grid.Column="4"
                           Text=""
                           FontSize="12"
                           Foreground="{DynamicResource TitleBarForeground}"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           Opacity="0.7" />

                <!-- Total cost across all projects -->
                <TextBlock x:Name="TotalCostText" Grid.Column="5"
                           Text=""
                           FontSize="11"
                           Foreground="{DynamicResource TitleBarForeground}"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"
                           Opacity="0.5" />

                <!-- Window buttons (right side) -->
                <Button Grid.Column="6"
                        Style="{StaticResource TitleBarButtonStyle}"
                        Click="MinimizeButton_Click"
                        ToolTip="Minimize"
                        WindowChrome.IsHitTestVisibleInChrome="True">
                    <TextBlock Text="&#xE921;"
                               FontFamily="Segoe MDL2 Assets"
                               FontSize="13"
                               Foreground="{DynamicResource TitleBarForeground}" />
                </Button>

                <Button x:Name="MaximizeButton" Grid.Column="7"
                        Style="{StaticResource TitleBarButtonStyle}"
                        Click="MaximizeButton_Click"
                        ToolTip="Maximize"
                        WindowChrome.IsHitTestVisibleInChrome="True">
                    <TextBlock x:Name="MaximizeIcon"
                               Text="&#xE922;"
                               FontFamily="Segoe MDL2 Assets"
                               FontSize="13"
                               Foreground="{DynamicResource TitleBarForeground}" />
                </Button>

                <Button Grid.Column="8"
                        Style="{StaticResource TitleBarCloseButtonStyle}"
                        Click="CloseButton_Click"
                        ToolTip="Close"
                        WindowChrome.IsHitTestVisibleInChrome="True" />

            </Grid>
        </Border>

        <!-- ===== Workspace area below title bar ===== -->
        <DockPanel x:Name="WorkspacePanel" LastChildFill="True">

            <!-- Project Toolbar -->
            <Border x:Name="ToolbarBorder" DockPanel.Dock="Top"
                    Background="{DynamicResource ToolbarBackground}"
                    BorderBrush="{DynamicResource ToolbarBorderBrush}" BorderThickness="0,0,0,1"
                    Visibility="Collapsed">
                <StackPanel x:Name="ToolbarPanel" Orientation="Horizontal"
                            Margin="4">
                    <!-- Project tab buttons are inserted here dynamically -->
                </StackPanel>
            </Border>

            <!-- Main Content Area -->
            <Grid x:Name="ContentArea" Background="{DynamicResource ContentBackground}">
                <StackPanel x:Name="EmptyStatePanel"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                    <Image Source="/Assets/agentdock.png"
                           Width="192" Height="192"
                           RenderOptions.BitmapScalingMode="HighQuality"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,20" />
                    <TextBlock Text="Open a project folder to get started"
                               HorizontalAlignment="Center"
                               FontSize="18"
                               Foreground="{DynamicResource EmptyStateForeground}"
                               Margin="0,0,0,16" />

                    <!-- Action buttons row -->
                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Center"
                                Margin="0,0,0,0">
                        <Button Click="AddProject_Click"
                                Cursor="Hand"
                                Padding="16,8"
                                Background="{DynamicResource TabButtonActiveBackground}"
                                BorderBrush="{DynamicResource TabButtonActiveBorderBrush}"
                                BorderThickness="1"
                                Foreground="{DynamicResource TabButtonForeground}">
                            <Button.Template>
                                <ControlTemplate TargetType="{x:Type Button}">
                                    <Border x:Name="Bd"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="4"
                                            Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center"
                                                          VerticalAlignment="Center" />
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Bd" Property="Background"
                                                    Value="{DynamicResource TitleBarButtonHover}" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE710;"
                                           FontFamily="Segoe MDL2 Assets"
                                           FontSize="12"
                                           Foreground="{DynamicResource TabButtonForeground}"
                                           VerticalAlignment="Center"
                                           Margin="0,0,6,0" />
                                <TextBlock Text="Add Project Folder"
                                           FontSize="13"
                                           Foreground="{DynamicResource TabButtonForeground}"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>
                        <Button Click="OpenWorkspace_Click"
                                Cursor="Hand"
                                Padding="16,8"
                                Margin="8,0,0,0"
                                Background="{DynamicResource TabButtonActiveBackground}"
                                BorderBrush="{DynamicResource TabButtonActiveBorderBrush}"
                                BorderThickness="1"
                                Foreground="{DynamicResource TabButtonForeground}">
                            <Button.Template>
                                <ControlTemplate TargetType="{x:Type Button}">
                                    <Border x:Name="Bd"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="4"
                                            Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center"
                                                          VerticalAlignment="Center" />
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Bd" Property="Background"
                                                    Value="{DynamicResource TitleBarButtonHover}" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE8E5;"
                                           FontFamily="Segoe MDL2 Assets"
                                           FontSize="12"
                                           Foreground="{DynamicResource TabButtonForeground}"
                                           VerticalAlignment="Center"
                                           Margin="0,0,6,0" />
                                <TextBlock Text="Open Workspace"
                                           FontSize="13"
                                           Foreground="{DynamicResource TabButtonForeground}"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <!-- Recent workspaces (populated dynamically) -->
                    <StackPanel x:Name="EmptyStateRecentPanel"
                                HorizontalAlignment="Center"
                                Margin="0,24,0,0"
                                Visibility="Collapsed">
                        <TextBlock Text="Recent Workspaces"
                                   HorizontalAlignment="Center"
                                   FontSize="13"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource EmptyStateForeground}"
                                   Margin="0,0,0,8" />
                        <StackPanel x:Name="EmptyStateRecentList" />
                    </StackPanel>
                </StackPanel>

                <ContentPresenter x:Name="ProjectContentHost"
                                  Visibility="Collapsed" />
            </Grid>

        </DockPanel>
    </DockPanel>

    <!-- Keyboard Shortcuts -->
    <Window.InputBindings>
        <KeyBinding Gesture="Ctrl+N" Command="{x:Static local:MainWindow.AddProjectCommand}" />
        <KeyBinding Gesture="Ctrl+S" Command="{x:Static local:MainWindow.SaveWorkspaceCommand}" />
        <KeyBinding Gesture="Ctrl+W" Command="{x:Static local:MainWindow.CloseProjectCommand}" />
    </Window.InputBindings>
</Window>
