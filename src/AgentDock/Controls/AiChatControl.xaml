<UserControl x:Class="AgentDock.Controls.AiChatControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:mdxaml="clr-namespace:MdXaml;assembly=MdXaml"
             mc:Ignorable="d"
             Background="{DynamicResource ChatBackground}">
    <UserControl.Resources>
        <Style x:Key="ChatButtonStyle" TargetType="Button">
            <Setter Property="FontFamily" Value="Cascadia Code, Consolas, Courier New" />
            <Setter Property="FontSize" Value="11" />
            <Setter Property="Foreground" Value="{DynamicResource ChatButtonForeground}" />
            <Setter Property="Background" Value="{DynamicResource ChatButtonBackground}" />
            <Setter Property="BorderBrush" Value="{DynamicResource ChatButtonBorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Padding" Value="8,4" />
        </Style>
        <Style x:Key="ChatMarkdownStyle" TargetType="FlowDocument">
            <Setter Property="Foreground" Value="{DynamicResource ChatTextForeground}" />
            <Setter Property="FontFamily" Value="Segoe UI, Segoe UI Emoji" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="PagePadding" Value="0" />
        </Style>
    </UserControl.Resources>
    <Grid>
        <!-- Start session overlay (shown when no session is active) -->
        <StackPanel x:Name="StartPanel"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    Width="280">
            <TextBlock Text="Agent Selection"
                       FontFamily="Cascadia Code, Consolas, Courier New"
                       FontSize="18" FontWeight="SemiBold"
                       Foreground="{DynamicResource ChatTextForeground}"
                       HorizontalAlignment="Center"
                       Margin="0,0,0,20" />
            <!-- Claude (normal) -->
            <Button x:Name="StartNormalButton"
                    Click="StartNormal_Click"
                    Cursor="Hand"
                    Margin="0,0,0,8"
                    Background="Transparent"
                    BorderThickness="0"
                    HorizontalContentAlignment="Stretch"
                    Padding="0">
                <Border Background="{DynamicResource ChatAgentCardBackground}"
                        BorderBrush="{DynamicResource ChatAgentCardBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="14,10">
                    <StackPanel>
                        <TextBlock Text="Claude"
                                   FontFamily="Cascadia Code, Consolas, Courier New"
                                   FontSize="13" FontWeight="SemiBold"
                                   Foreground="{DynamicResource ChatTextForeground}" />
                        <TextBlock Text="Standard session with permission prompts"
                                   FontFamily="Cascadia Code, Consolas, Courier New"
                                   FontSize="10"
                                   Foreground="{DynamicResource ChatMutedForeground}"
                                   Margin="0,3,0,0" />
                    </StackPanel>
                </Border>
            </Button>
            <!-- Claude Unrestricted (dangerous) -->
            <Button x:Name="StartDangerousButton"
                    Click="StartDangerous_Click"
                    Cursor="Hand"
                    Margin="0,0,0,8"
                    Background="Transparent"
                    BorderThickness="0"
                    HorizontalContentAlignment="Stretch"
                    Padding="0"
                    ToolTip="Bypasses all permission prompts â€” the agent can execute any tool without asking. Use with caution.">
                <Border Background="{DynamicResource ChatDangerBackground}"
                        BorderBrush="{DynamicResource ChatDangerBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="14,10">
                    <StackPanel>
                        <TextBlock Text="Claude Unrestricted"
                                   FontFamily="Cascadia Code, Consolas, Courier New"
                                   FontSize="13" FontWeight="SemiBold"
                                   Foreground="{DynamicResource ChatDangerForeground}" />
                        <TextBlock Text="No permission prompts (--dangerously-skip-permissions)"
                                   FontFamily="Cascadia Code, Consolas, Courier New"
                                   FontSize="10"
                                   Foreground="{DynamicResource ChatDangerMutedForeground}"
                                   Margin="0,3,0,0" />
                    </StackPanel>
                </Border>
            </Button>
            <TextBlock x:Name="StartError"
                       Visibility="Collapsed"
                       FontFamily="Cascadia Code, Consolas, Courier New"
                       FontSize="11"
                       Foreground="{DynamicResource ChatDangerForeground}"
                       HorizontalAlignment="Center"
                       TextWrapping="Wrap"
                       MaxWidth="300"
                       Margin="0,8,0,0" />
        </StackPanel>

        <!-- Chat area (shown when session is active) -->
        <DockPanel x:Name="ChatPanel" Visibility="Collapsed">

            <!-- Status bar at top -->
            <Border DockPanel.Dock="Top" Background="{DynamicResource ChatStatusBarBackground}" Padding="8,4">
                <DockPanel>
                    <TextBlock x:Name="StatusText"
                               Text="Initializing..."
                               FontFamily="Cascadia Code, Consolas, Courier New"
                               FontSize="11"
                               Foreground="{DynamicResource ChatMutedForeground}"
                               VerticalAlignment="Center" />
                    <Button x:Name="StopButton"
                            Content="Stop"
                            Click="Stop_Click"
                            DockPanel.Dock="Right"
                            HorizontalAlignment="Right"
                            FontFamily="Cascadia Code, Consolas, Courier New"
                            FontSize="10"
                            Foreground="{DynamicResource ChatDangerForeground}"
                            Background="Transparent"
                            BorderBrush="{DynamicResource ChatStopButtonBorderBrush}"
                            BorderThickness="1"
                            Cursor="Hand"
                            Padding="8,2" />
                </DockPanel>
            </Border>

            <!-- Permission prompt (replaces input when permission needed) -->
            <Border x:Name="PermissionPanel"
                    DockPanel.Dock="Bottom"
                    Visibility="Collapsed"
                    Background="{DynamicResource ChatPermissionBackground}"
                    BorderBrush="{DynamicResource ChatPermissionBorderBrush}"
                    BorderThickness="0,1,0,0"
                    Padding="8,6">
                <StackPanel>
                    <TextBlock Text="Permission Required"
                               FontFamily="Cascadia Code, Consolas, Courier New"
                               FontSize="12" FontWeight="SemiBold"
                               Foreground="{DynamicResource ChatPermissionTitleForeground}"
                               Margin="0,0,0,4" />
                    <TextBlock x:Name="PermissionToolName"
                               FontFamily="Cascadia Code, Consolas, Courier New"
                               FontSize="11"
                               Foreground="{DynamicResource ChatTextForeground}"
                               Margin="0,0,0,4" />
                    <ScrollViewer MaxHeight="120"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Auto"
                                  Margin="0,0,0,6">
                        <TextBlock x:Name="PermissionDetail"
                                   FontFamily="Cascadia Code, Consolas, Courier New"
                                   FontSize="10"
                                   Foreground="{DynamicResource ChatMutedForeground}"
                                   TextWrapping="Wrap" />
                    </ScrollViewer>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="Allow"
                                Click="PermissionAllow_Click"
                                Style="{StaticResource ChatButtonStyle}"
                                Width="80" Height="28"
                                Margin="0,0,6,0" />
                        <Button Content="Deny"
                                Click="PermissionDeny_Click"
                                FontFamily="Cascadia Code, Consolas, Courier New"
                                FontSize="11"
                                Foreground="{DynamicResource ChatDangerForeground}"
                                Background="{DynamicResource ChatDangerBackground}"
                                BorderBrush="{DynamicResource ChatStopButtonBorderBrush}"
                                BorderThickness="1"
                                Cursor="Hand"
                                Padding="8,4"
                                Width="80" Height="28" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Question prompt (replaces input when AskUserQuestion needed) -->
            <Border x:Name="QuestionPanel"
                    DockPanel.Dock="Bottom"
                    Visibility="Collapsed"
                    Background="{DynamicResource ChatQuestionBackground}"
                    BorderBrush="{DynamicResource ChatQuestionBorderBrush}"
                    BorderThickness="0,1,0,0"
                    Padding="8,6">
                <StackPanel>
                    <TextBlock x:Name="QuestionText"
                               FontFamily="Cascadia Code, Consolas, Courier New"
                               FontSize="12" FontWeight="SemiBold"
                               Foreground="{DynamicResource ChatQuestionTitleForeground}"
                               TextWrapping="Wrap"
                               Margin="0,0,0,6" />
                    <StackPanel x:Name="QuestionOptionsPanel" Margin="0,0,0,6" />
                    <DockPanel Margin="0,2,0,0">
                        <Button Content="Send"
                                Click="QuestionCustomSend_Click"
                                DockPanel.Dock="Right"
                                FontFamily="Cascadia Code, Consolas, Courier New"
                                FontSize="10"
                                Foreground="{DynamicResource ChatTextForeground}"
                                Background="{DynamicResource ChatOptionButtonBackground}"
                                BorderBrush="{DynamicResource ChatQuestionBorderBrush}"
                                BorderThickness="1"
                                Cursor="Hand"
                                Padding="8,4"
                                Height="26"
                                Margin="6,0,0,0" />
                        <TextBox x:Name="QuestionCustomInput"
                                 FontFamily="Cascadia Code, Consolas, Courier New"
                                 FontSize="11"
                                 Foreground="{DynamicResource ChatInputForeground}"
                                 Background="{DynamicResource ChatInputBackground}"
                                 CaretBrush="{DynamicResource ChatInputForeground}"
                                 BorderBrush="{DynamicResource ChatInputBorderBrush}"
                                 BorderThickness="1"
                                 Padding="4,3"
                                 ToolTip="Type a custom response"
                                 KeyDown="QuestionCustomInput_KeyDown" />
                    </DockPanel>
                </StackPanel>
            </Border>

            <!-- Input area -->
            <Border x:Name="InputPanel"
                    DockPanel.Dock="Bottom"
                    Background="{DynamicResource ChatStatusBarBackground}"
                    BorderBrush="{DynamicResource ChatInputBorderBrush}"
                    BorderThickness="0,1,0,0"
                    Padding="8,6">
                <DockPanel>
                    <TextBlock Text=">"
                               DockPanel.Dock="Left"
                               FontFamily="Cascadia Code, Consolas, Courier New"
                               FontSize="14" FontWeight="Bold"
                               Foreground="{DynamicResource ChatInputPromptForeground}"
                               VerticalAlignment="Center"
                               Margin="0,0,6,0" />
                    <Button x:Name="SendButton"
                            Content="Send"
                            Click="Send_Click"
                            DockPanel.Dock="Right"
                            Style="{StaticResource ChatButtonStyle}"
                            Width="60" Height="28"
                            Margin="6,0,0,0" />
                    <TextBox x:Name="InputBox"
                             FontFamily="Cascadia Code, Consolas, Courier New"
                             FontSize="12"
                             Foreground="{DynamicResource ChatInputForeground}"
                             Background="{DynamicResource ChatInputBackground}"
                             CaretBrush="{DynamicResource ChatInputForeground}"
                             BorderBrush="{DynamicResource ChatInputBorderBrush}"
                             BorderThickness="1"
                             Padding="6,4"
                             AcceptsReturn="False"
                             KeyDown="InputBox_KeyDown"
                             VerticalContentAlignment="Center" />
                </DockPanel>
            </Border>

            <!-- Message list -->
            <ScrollViewer x:Name="MessageScroller"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          Background="{DynamicResource ChatBackground}">
                <StackPanel x:Name="MessageList"
                            Margin="8,8,8,8" />
            </ScrollViewer>
        </DockPanel>
    </Grid>
</UserControl>
